<!DOCTYPE html>
<html>
<head>
  <title>Previsão de Futebol Avançada</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #f0f0f0;
      padding: 20px;
    }

    h1, h2 {
      text-align: center;
    }

    .search-bar {
      text-align: center;
      margin-bottom: 20px;
    }

    input[type="text"] {
      padding: 10px;
      width: 70%;
      border-radius: 5px;
      border: none;
      margin-right: 10px;
    }

    button {
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      background-color: #1e88e5;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #1565c0;
    }

    .card {
      background-color: #1f1f1f;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    #jogadores li {
      margin-bottom: 5px;
    }

    canvas {
      background-color: #1f1f1f;
      border-radius: 10px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Previsão de Futebol Avançada</h1>

  <div class="search-bar">
    <input type="text" id="teamInput" placeholder="Digite o nome do time">
    <button onclick="buscarTime()">Buscar</button>
  </div>

  <h2>Últimos resultados</h2>
  <div id="resultados"></div>

  <h2>Previsões ajustadas</h2>
  <div id="previsoes" class="card"></div>

  <h2>Jogadores aptos</h2>
  <ul id="jogadores"></ul>

  <h2>Gráficos de desempenho</h2>
  <canvas id="golsChart" width="400" height="200"></canvas>
  <canvas id="cartoesChart" width="400" height="200"></canvas>
  <canvas id="cantosChart" width="400" height="200"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Times e IDs da API
    const times = {
      "Real Madrid": 33, "Barcelona": 529, "Atlético Madrid": 541, "Sevilla": 530,
      "Manchester United": 42, "Liverpool": 50, "Manchester City": 46, "Chelsea": 49,
      "Bayern Munique": 157, "Borussia Dortmund": 158,
      "Juventus": 109, "Inter de Milão": 108,
      "Paris Saint-Germain": 85,
      "Club Brugge": 621, "Gent": 622,
      "Ajax": 87, "PSV": 88, "Feyenoord": 89,
      "Galatasaray": 574, "Fenerbahçe": 577, "Beşiktaş": 580, "Trabzonspor": 581
    };

    // Relatórios médicos simulados
    const relatoriosMedicos = {
      "33":[{nome:"Vinicius Jr", aptidao:100},{nome:"Benzema", aptidao:80},{nome:"Courtois", aptidao:100},{nome:"Modric", aptidao:90}],
      "529":[{nome:"Lewandowski", aptidao:100},{nome:"Ter Stegen", aptidao:100},{nome:"Frenkie de Jong", aptidao:85},{nome:"Pedri", aptidao:90}],
      "541":[{nome:"Griezmann", aptidao:90},{nome:"Oblak", aptidao:100},{nome:"Koke", aptidao:95},{nome:"Llorente", aptidao:85}],
      "42":[{nome:"Rashford", aptidao:100},{nome:"De Gea", aptidao:90},{nome:"Bruno Fernandes", aptidao:95},{nome:"Casemiro", aptidao:85}],
      "50":[{nome:"Salah", aptidao:100},{nome:"Van Dijk", aptidao:100},{nome:"Alisson", aptidao:100},{nome:"Henderson", aptidao:90}],
      "157":[{nome:"Lewandowski", aptidao:100},{nome:"Neuer", aptidao:100},{nome:"Kimmich", aptidao:95},{nome:"Gnabry", aptidao:90}],
      "158":[{nome:"Haaland", aptidao:100},{nome:"Reus", aptidao:85},{nome:"Bürki", aptidao:90},{nome:"Brandt", aptidao:80}],
      "109":[{nome:"Vlahovic", aptidao:95},{nome:"Donnarumma", aptidao:100},{nome:"Chiesa", aptidao:90},{nome:"Locatelli", aptidao:85}],
      "108":[{nome:"Lukaku", aptidao:90},{nome:"Handanovic", aptidao:100},{nome:"Brozovic", aptidao:90},{nome:"Dzeko", aptidao:85}],
      "85":[{nome:"Messi", aptidao:100},{nome:"Neymar", aptidao:90},{nome:"Mbappe", aptidao:100},{nome:"Donnarumma", aptidao:100}],
      "621":[{nome:"Vormer", aptidao:90},{nome:"Denswil", aptidao:85},{nome:"Vanaken", aptidao:95},{nome:"Lang", aptidao:100}],
      "622":[{nome:"Samatta", aptidao:90},{nome:"Trossard", aptidao:95},{nome:"Ngadeu", aptidao:85},{nome:"Hrosovsky", aptidao:80}],
      "87":[{nome:"Tadic", aptidao:95},{nome:"Onana", aptidao:100},{nome:"Berghuis", aptidao:90},{nome:"Haller", aptidao:100}],
      "88":[{nome:"Gakpo", aptidao:95},{nome:"Drommel", aptidao:90},{nome:"Rensch", aptidao:85},{nome:"Gotze", aptidao:80}],
      "574":[{nome:"Falcao", aptidao:90},{nome:"Muslera", aptidao:100},{nome:"Yilmaz", aptidao:95},{nome:"Pelkas", aptidao:85}],
      "577":[{nome:"Enner Valencia", aptidao:90},{nome:"Altay", aptidao:100},{nome:"Joshua King", aptidao:85},{nome:"Pelkas", aptidao:80}],
      "580":[{nome:"Vlahovic", aptidao:90},{nome:"Loris", aptidao:95},{nome:"Rosier", aptidao:85},{nome:"Rashica", aptidao:80}],
      "581":[{nome:"Bakasetas", aptidao:90},{nome:"Uğurcan", aptidao:100},{nome:"Nwakaeme", aptidao:85},{nome:"Cornelius", aptidao:80}]
    };

    async function buscarTime() {
      const nomeTime = document.getElementById("teamInput").value.trim();
      if(!times[nomeTime]){
        alert("Time não encontrado! Digite exatamente como listado.");
        return;
      }
      const teamId = times[nomeTime];
      const url = `https://v3.football.api-sports.io/fixtures?team=${teamId}&last=5`;

      try {
        const res = await fetch(url, {
          method: 'GET',
          headers: {
            'X-RapidAPI-Key': 'a1c8a92831aa83b9846d6433064d199d',
            'X-RapidAPI-Host': 'api-football-v1.p.rapidapi.com'
          }
        });

        const data = await res.json();
        const jogos = data.response;

        // Mostrar resultados
        const resultadosDiv = document.getElementById("resultados");
        resultadosDiv.innerHTML = "";
        jogos.forEach(jogo => {
          resultadosDiv.innerHTML += `<div class="card">${jogo.teams.home.name} ${jogo.goals.home} - ${jogo.goals.away} ${jogo.teams.away.name}</div>`;
        });

        // Ajuste de previsão pelos jogadores
        let totalGols = 0;
        let totalAdversario = 0;
        let n = jogos.length;

        jogos.forEach(j => {
          totalGols += j.goals.home;
          totalAdversario += j.goals.away;
        });

        // Calcula média de aptidão do time
        const jogadores = relatoriosMedicos[teamId] || [];
        const mediaAptidao = jogadores.reduce((acc,j)=>acc+j.aptidao,0)/jogadores.length;

        // Ajusta previsão de gols pelo estado físico (ex: 80% aptidão = 0.8 fator)
        const fator = mediaAptidao/100;
        const golsPrevistos = (totalGols/n)*fator;
        const golsAdversarioPrevistos = (totalAdversario/n);

        // Mostrar previsões
        const previsoesDiv = document.getElementById("previsoes");
        previsoesDiv.innerHTML = `
          <p>Gols previstos: ${golsPrevistos.toFixed(1)}</p>
          <p>Gols do adversário: ${golsAdversarioPrevistos.toFixed(1)}</p>
          <p>BTTS provável: ${(golsPrevistos>0 && golsAdversarioPrevistos>0) ? "Sim":"Não"}</p>
          <p>Média de aptidão do time: ${mediaAptidao.toFixed(0)}%</p>
        `;

        // Mostrar jogadores aptos
        const jogadoresUl = document.getElementById("jogadores");
        jogadoresUl.innerHTML = "";
        jogadores.forEach(j=>jogadoresUl.innerHTML+=`<li>${j.nome} - ${j.aptidao}% apto</li>`);

        // Gráficos
        const labels = jogos.map(j=>`${j.teams.home.name} vs ${j.teams.away.name}`);
        const golsData = jogos.map(j=>j.goals.home*fator);
        const cartoesData = jogos.map(j=>j.statistics ? j.statistics.cards.yellow+j.statistics.cards.red : 0);
        const cantosData = jogos.map(j=>j.statistics ? j.statistics.corners.total : 0);

        new Chart(document.getElementById('golsChart'), {type:'bar',data:{labels,datasets:[{label:'Gols (ajustados pela aptidão)',data:golsData,backgroundColor:'#1e88e5'}]}});
        new Chart(document.getElementById('cartoesChart'), {type:'bar',data:{labels,datasets:[{label:'Cartões',data:cartoesData,backgroundColor:'#e53935'}]}});
        new Chart(document.getElementById('cantosChart'), {type:'bar',data:{labels,datasets:[{label:'Cantos',data:cantosData,backgroundColor:'#43a047'}]}});
        
      } catch(error) {
        console.error(error);
        alert("Erro ao buscar resultados!");
      }
    }
  </script>
</body>
</html>

